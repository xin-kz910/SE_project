{% extends "base.html" %}
{% block title %}å°ˆæ¡ˆåˆ—è¡¨{% endblock %}

{% block content %}
<div class="section-card">
{% if user and user.role == 'client' %}
  <h2 class="role-title client">å§”è¨—äººå·¥ä½œå°</h2>
{% elif user and user.role == 'freelancer' %}
  <h2 class="role-title freelancer">æ¥æ¡ˆäººå·¥ä½œå°</h2>
{% else %}
  <h2 class="role-title visitor">æ¥æ¡ˆå¹³å°</h2>
{% endif %}

{% if user and user.role == 'client' %}
  <h2 style="margin:8px 0 0">æˆ‘çš„å°ˆæ¡ˆ</h2>
  <div class="tabs">
    <a href="/?tab=open" class="{{ 'active' if tab=='open' else '' }}">ğŸŸ© æŠ•æ”¾ä¸­ <span class="count">{{ stats.open }}</span></a>
    <a href="/?tab=progress" class="{{ 'active' if tab=='progress' else '' }}">ğŸŸ§ é€²è¡Œä¸­ ({{ stats.progress }})</a>
    <a href="/?tab=closed" class="{{ 'active' if tab=='closed' else '' }}">â¬œ æ­·å²å°ˆæ¡ˆ ({{ stats.closed }})</a>
  </div>
{% elif user and user.role == 'freelancer' %}
  <h2 style="margin:8px 0 0">æ¥æ¡ˆå°ˆå€</h2>
  <div class="tabs">
    <a href="/?tab=open" class="{{ 'active' if tab=='open' else '' }}">ğŸŸ© å¯æ¥æ¡ˆ ({{ stats.open }})</a>
    <a href="/?tab=progress" class="{{ 'active' if tab=='progress' else '' }}">ğŸŸ§ é€²è¡Œä¸­ ({{ stats.progress }})</a>
    <a href="/?tab=closed" class="{{ 'active' if tab=='closed' else '' }}">â¬œ æ­·å²ç´€éŒ„ ({{ stats.closed }})</a>
  </div>
{% else %}
  <h2 style="margin:8px 0 0">å¯æ¥æ¡ˆå°ˆæ¡ˆ</h2>
{% endif %}

<hr style="border:none;border-top:1px solid var(--line);margin:12px 0" />

<ul class="project-list">
  {% for p in projects %}
  <li class="card is-{{ 'open' if p.status=='open' else ('progress' if p.status=='in_progress' else ('reopened' if p.status=='reopened' else 'closed')) }}">
    <!-- âœ… æ•´å¼µå¡ç‰‡çš„é€æ˜é€£çµï¼šä¸€å®šè¦æ˜¯ç¬¬ä¸€å€‹å­å…ƒç´  -->
    <a class="card-link" href="/projects/{{ p.id }}" aria-label="æŸ¥çœ‹è©³æƒ…"></a>

    <div class="row">
      <div class="title">
        <span class="seq">#{{ loop.index }}</span>
        <span class="status-dot"></span>
        <span class="card-title-text">{{ p.title }}</span>
      </div>
      <div class="badges">
        {% if user and user.role=='client' and tab=='open' and p.bid_count is defined %}
          <span class="badge blue">ğŸ“ {{ p.bid_count }} ä½å ±åƒ¹</span>
        {% endif %}
        {% if user and user.role=='freelancer' and tab=='open' and p.has_bid %}
          <span class="badge yellow">å·²å ±åƒ¹</span>
        {% endif %}
        {% if tab=='progress' %}
          {% if user and user.role=='client' and p.delivery_count|default(0) > 0 %}
            <span class="badge green">å¾…å¯©æ ¸</span>
          {% elif user and user.role=='freelancer' and p.my_delivery_count|default(0) > 0 %}
            <span class="badge green">å¾…å¯©æ ¸</span>
          {% elif p.status=='reopened' %}
            <span class="badge red">è¢«é€€ä»¶</span>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <div class="meta">
      ç‹€æ…‹ï¼š
      {% if p.status=='open' %}æŠ•æ”¾ä¸­{% elif p.status=='in_progress' %}é€²è¡Œä¸­{% elif p.status=='reopened' %}è¢«é€€ä»¶{% else %}å·²çµæ¡ˆ{% endif %}
      ï½œ å»ºç«‹æ™‚é–“ï¼š{{ p.created_at }}
    </div>

    {% if p.description %}
      <!-- é¡¯ç¤ºå‰å¹¾è¡Œæ‘˜è¦ï¼ˆCSS æœƒåš 2~3 è¡Œå¤¾æ–·ï¼‰ -->
      <p class="excerpt">{{ p.description }}</p>
    {% endif %}
  </li>
  {% else %}
  <li class="empty">ç›®å‰æ²’æœ‰å°ˆæ¡ˆã€‚</li>
  {% endfor %}
</ul>
</div>
{% endblock %}
